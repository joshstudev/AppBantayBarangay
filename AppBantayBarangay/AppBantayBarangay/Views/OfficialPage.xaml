<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Xamarin.Forms.Maps;assembly=Xamarin.Forms.Maps"
             x:Class="AppBantayBarangay.Views.OfficialPage"
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="#F5F5F5">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryBlue">#007AFF</Color>
            <Color x:Key="AccentYellow">#FFD700</Color>
            <Color x:Key="AccentRed">#FF3B30</Color>
            <Color x:Key="AccentGreen">#34C759</Color>
            <Color x:Key="AccentOrange">#FF9500</Color>
            <Color x:Key="LightGray">#F5F5F5</Color>
            <Color x:Key="MediumGray">#E0E0E0</Color>
            <Color x:Key="DarkGray">#666666</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" BackgroundColor="{StaticResource PrimaryBlue}" Padding="20,10" HeightRequest="70">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <Frame Grid.Column="0" 
                   HeightRequest="50" 
                   WidthRequest="50" 
                   CornerRadius="25" 
                   Padding="3" 
                   BackgroundColor="Transparent" 
                   BorderColor="Transparent"
                   VerticalOptions="Center" 
                   HorizontalOptions="Start"
                   HasShadow="False">
                <Image Source="logo" 
                       Aspect="AspectFit"
                       HorizontalOptions="Center" 
                       VerticalOptions="Center"/>
            </Frame>

            <StackLayout Grid.Column="1" 
                        VerticalOptions="Center" 
                        HorizontalOptions="Center">
                <Label Text="Official Dashboard" 
                       TextColor="White" 
                       FontSize="22" 
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center"/>
                <Label x:Name="WelcomeLabel"
                       Text="Welcome!" 
                       TextColor="White" 
                       FontSize="14" 
                       HorizontalTextAlignment="Center"/>
            </StackLayout>

            <Button Grid.Column="2"
                    x:Name="LogoutButton"
                    Text="⎋"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    FontSize="20"
                    HeightRequest="40"
                    WidthRequest="40"
                    CornerRadius="20"
                    Padding="0"
                    VerticalOptions="Center"
                    Clicked="LogoutButton_Clicked"/>
        </Grid>

        <!-- Main Content with Pull-to-Refresh -->
        <RefreshView Grid.Row="1" 
                     x:Name="RefreshView"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     RefreshColor="{StaticResource PrimaryBlue}"
                     Refreshing="OnRefreshing">
            <ScrollView>
            <StackLayout Padding="15" Spacing="15">

                <!-- Statistics Cards -->
                <Label Text="Overview" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       TextColor="{StaticResource PrimaryBlue}"
                       Margin="0,10,0,5"/>

                <Grid ColumnSpacing="10" RowSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Pending Reports Card -->
                    <Frame Grid.Row="0" Grid.Column="0" 
                           BackgroundColor="White" 
                           CornerRadius="15" 
                           Padding="15"
                           HasShadow="True">
                        <StackLayout Spacing="5">
                            <Label Text="⏳" 
                                   FontSize="30" 
                                   HorizontalOptions="Center"/>
                            <Label x:Name="PendingCountLabel"
                                   Text="0" 
                                   FontSize="28" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource AccentOrange}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Pending" 
                                   FontSize="14" 
                                   TextColor="{StaticResource DarkGray}"
                                   HorizontalOptions="Center"/>
                        </StackLayout>
                    </Frame>

                    <!-- In Progress Card -->
                    <Frame Grid.Row="0" Grid.Column="1" 
                           BackgroundColor="White" 
                           CornerRadius="15" 
                           Padding="15"
                           HasShadow="True">
                        <StackLayout Spacing="5">
                            <Label Text="🔄" 
                                   FontSize="30" 
                                   HorizontalOptions="Center"/>
                            <Label x:Name="InProgressCountLabel"
                                   Text="0" 
                                   FontSize="28" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource PrimaryBlue}"
                                   HorizontalOptions="Center"/>
                            <Label Text="In Progress" 
                                   FontSize="14" 
                                   TextColor="{StaticResource DarkGray}"
                                   HorizontalOptions="Center"/>
                        </StackLayout>
                    </Frame>

                    <!-- Resolved Card -->
                    <Frame Grid.Row="1" Grid.Column="0" 
                           BackgroundColor="White" 
                           CornerRadius="15" 
                           Padding="15"
                           HasShadow="True">
                        <StackLayout Spacing="5">
                            <Label Text="✅" 
                                   FontSize="30" 
                                   HorizontalOptions="Center"/>
                            <Label x:Name="ResolvedCountLabel"
                                   Text="0" 
                                   FontSize="28" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource AccentGreen}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Resolved" 
                                   FontSize="14" 
                                   TextColor="{StaticResource DarkGray}"
                                   HorizontalOptions="Center"/>
                        </StackLayout>
                    </Frame>

                    <!-- Total Reports Card -->
                    <Frame Grid.Row="1" Grid.Column="1" 
                           BackgroundColor="White" 
                           CornerRadius="15" 
                           Padding="15"
                           HasShadow="True">
                        <StackLayout Spacing="5">
                            <Label Text="📊" 
                                   FontSize="30" 
                                   HorizontalOptions="Center"/>
                            <Label x:Name="TotalCountLabel"
                                   Text="0" 
                                   FontSize="28" 
                                   FontAttributes="Bold" 
                                   TextColor="{StaticResource PrimaryBlue}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Total Reports" 
                                   FontSize="14" 
                                   TextColor="{StaticResource DarkGray}"
                                   HorizontalOptions="Center"/>
                        </StackLayout>
                    </Frame>
                </Grid>

                <!-- Filter Section -->
                <Label Text="Filter" 
                       FontSize="18" 
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryBlue}"
                       Margin="0,10,0,5"/>
                
                <Grid ColumnSpacing="10" RowSpacing="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    
                    <Button Grid.Column="0"
                            x:Name="AllButton"
                            Text="All"
                            BackgroundColor="{StaticResource PrimaryBlue}"
                            TextColor="White"
                            CornerRadius="15"
                            Padding="15,8"
                            FontSize="14"
                            Clicked="FilterButton_Clicked"/>
                    
                    <Button Grid.Column="1"
                            x:Name="PendingButton"
                            Text="Pending"
                            BackgroundColor="{StaticResource MediumGray}"
                            TextColor="{StaticResource DarkGray}"
                            CornerRadius="15"
                            Padding="15,8"
                            FontSize="14"
                            Clicked="FilterButton_Clicked"/>
                    
                    <Button Grid.Column="2"
                            x:Name="InProgressButton"
                            Text="In Progress"
                            BackgroundColor="{StaticResource MediumGray}"
                            TextColor="{StaticResource DarkGray}"
                            CornerRadius="15"
                            Padding="15,8"
                            FontSize="13"
                            Clicked="FilterButton_Clicked"/>
                </Grid>

                <!-- Reports List -->
                <Label Text="Reports" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       TextColor="{StaticResource PrimaryBlue}"
                       Margin="0,10,0,5"/>

                <StackLayout x:Name="ReportsContainer" 
                            Spacing="10">
                    <!-- Reports will be dynamically added here -->
                </StackLayout>

                <!-- Empty State -->
                <StackLayout x:Name="EmptyStateContainer"
                            IsVisible="False"
                            Padding="20"
                            VerticalOptions="CenterAndExpand"
                            HorizontalOptions="CenterAndExpand">
                    <Label Text="📭" 
                           FontSize="60" 
                           HorizontalOptions="Center"/>
                    <Label Text="No reports found" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource DarkGray}"
                           HorizontalOptions="Center"
                           Margin="0,10,0,5"/>
                    <Label Text="Reports will appear here when residents submit them" 
                           FontSize="14" 
                           TextColor="{StaticResource DarkGray}"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"/>
                </StackLayout>
            </StackLayout>
            </ScrollView>
        </RefreshView>
        
        <!-- Loading Overlay -->
        <Grid Grid.Row="0" 
              Grid.RowSpan="2"
              x:Name="LoadingOverlay"
              IsVisible="False"
              BackgroundColor="#CC000000">
            <StackLayout VerticalOptions="Center" 
                        HorizontalOptions="Center"
                        Spacing="20">
                <ActivityIndicator IsRunning="True"
                                 Color="White"
                                 HeightRequest="50"
                                 WidthRequest="50"/>
                <Label Text="Loading reports..."
                       TextColor="White"
                       FontSize="16"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </StackLayout>
        </Grid>

        <!-- Report Details Modal (Initially Hidden) -->
        <Frame x:Name="ReportDetailsModal"
               IsVisible="False"
               BackgroundColor="#CC000000"
               Padding="0"
               CornerRadius="0"
               Grid.Row="0"
               Grid.RowSpan="2">
            <Frame BackgroundColor="White"
                   CornerRadius="20"
                   Padding="0"
                   Margin="20"
                   VerticalOptions="Center"
                   HasShadow="True">
                <ScrollView>
                    <StackLayout Padding="20" Spacing="15">
                        <!-- Modal Header -->
                        <Grid>
                            <Label Text="Report Details" 
                                   FontSize="22" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                            <Button x:Name="CloseModalButton"
                                    Text="✕"
                                    BackgroundColor="Transparent"
                                    TextColor="{StaticResource DarkGray}"
                                    FontSize="24"
                                    FontAttributes="Bold"
                                    HeightRequest="40"
                                    WidthRequest="40"
                                    CornerRadius="20"
                                    Padding="0"
                                    HorizontalOptions="End"
                                    Clicked="CloseModal_Clicked"/>
                        </Grid>

                        <BoxView HeightRequest="1" 
                                BackgroundColor="{StaticResource MediumGray}"/>

                        <!-- Report Image -->
                        <Frame BorderColor="{StaticResource MediumGray}" 
                               CornerRadius="10" 
                               Padding="0"
                               HasShadow="False">
                            <Image x:Name="ModalReportImage"
                                   HeightRequest="200"
                                   Aspect="AspectFill"/>
                        </Frame>

                        <!-- Report Info -->
                        <StackLayout Spacing="10">
                            <Label Text="Description" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"/>
                            <Label x:Name="ModalDescription"
                                   FontSize="14"
                                   TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Reported By" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"
                                   Margin="0,10,0,0"/>
                            <Label x:Name="ModalReportedBy"
                                   FontSize="14"
                                   TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Date Reported" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"
                                   Margin="0,10,0,0"/>
                            <Label x:Name="ModalDateReported"
                                   FontSize="14"
                                   TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Location" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"
                                   Margin="0,10,0,0"/>
                            <Label x:Name="ModalLocation"
                                   FontSize="14"
                                   TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Latitude" 
                FontSize="16" 
                FontAttributes="Bold"
                TextColor="{StaticResource PrimaryBlue}"
                Margin="0,10,0,0"/>
                            <Label x:Name="ModalLat"
                FontSize="14"
                TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Longitude" 
                FontSize="16" 
                FontAttributes="Bold"
                TextColor="{StaticResource PrimaryBlue}"
                Margin="0,10,0,0"/>
                            <Label x:Name="ModalLong"
                FontSize="14"
                TextColor="{StaticResource DarkGray}"/>

                            <Label Text="Status" 
                                   FontSize="16" 
                                   FontAttributes="Bold"
                                   TextColor="{StaticResource PrimaryBlue}"
                                   Margin="0,10,0,0"/>
                            <Frame x:Name="ModalStatusFrame"
                                   BackgroundColor="{StaticResource AccentOrange}"
                                   CornerRadius="15"
                                   Padding="10,5"
                                   HasShadow="False"
                                   HorizontalOptions="Start">
                                <Label x:Name="ModalStatus"
                                       Text="Pending"
                                       TextColor="White"
                                       FontSize="14"
                                       FontAttributes="Bold"/>
                            </Frame>

                            <!-- Resolution Notes (for resolved reports) -->
                            <StackLayout x:Name="ResolutionNotesContainer"
                                        IsVisible="False"
                                        Spacing="5">
                                <Label Text="Resolution Notes" 
                                       FontSize="16" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource PrimaryBlue}"
                                       Margin="0,10,0,0"/>
                                <Label x:Name="ModalResolutionNotes"
                                       FontSize="14"
                                       TextColor="{StaticResource DarkGray}"/>
                                <Label x:Name="ModalResolvedBy"
                                       FontSize="12"
                                       TextColor="{StaticResource DarkGray}"
                                       FontAttributes="Italic"/>
                            </StackLayout>
                        </StackLayout>

                        <!-- Action Buttons -->
                        <StackLayout x:Name="ActionButtonsContainer" 
                                    Spacing="10" 
                                    Margin="0,10,0,0">

                            <!-- Resolution Notes Entry (Initially Hidden) -->
                            <StackLayout x:Name="ResolutionInputContainer"
                                        IsVisible="False"
                                        Spacing="10">
                                <Label Text="Resolution Notes" 
                                       FontSize="16" 
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource PrimaryBlue}"/>
                                <Frame BorderColor="{StaticResource PrimaryBlue}" 
                                       CornerRadius="10" 
                                       Padding="5">
                                    <Editor x:Name="ResolutionNotesEditor"
                                           Placeholder="Enter resolution details..."
                                           HeightRequest="100"
                                            TextColor="Black"
                                           AutoSize="TextChanges"/>
                                </Frame>
                            </StackLayout>

                            <Button x:Name="MarkInProgressButton"
                                   Text="Mark as In Progress"
                                   BackgroundColor="{StaticResource PrimaryBlue}"
                                   TextColor="White"
                                   CornerRadius="10"
                                   Clicked="MarkInProgress_Clicked"/>

                            <Button x:Name="MarkResolvedButton"
                                   Text="Mark as Resolved"
                                   BackgroundColor="{StaticResource AccentGreen}"
                                   TextColor="White"
                                   CornerRadius="10"
                                   Clicked="MarkResolved_Clicked"/>

                            <Button x:Name="RejectButton"
                                   Text="Reject Report"
                                   BackgroundColor="{StaticResource AccentRed}"
                                   TextColor="White"
                                   CornerRadius="10"
                                   Clicked="RejectReport_Clicked"/>
                        </StackLayout>
                    </StackLayout>
                </ScrollView>
            </Frame>
        </Frame>
    </Grid>
</ContentPage>
